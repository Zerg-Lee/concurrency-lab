==================
WARNING: ThreadSanitizer: data race (pid=311410)
  Read of size 8 at 0x7b0800000020 by thread T2:
    #0 channel_non_blocking_send /vagrant/channel.c:84 (channel_sanitize+0xbcbf1)
    #1 helper_non_blocking_send /vagrant/test.c:111 (channel_sanitize+0xbf716)

  Previous write of size 8 at 0x7b0800000020 by thread T1 (mutexes: write M0):
    #0 buffer_add /vagrant/buffer.c:28 (channel_sanitize+0xbd01a)
    #1 channel_non_blocking_send /vagrant/channel.c:98 (channel_sanitize+0xbcc6a)
    #2 helper_non_blocking_send /vagrant/test.c:111 (channel_sanitize+0xbf716)

  Location is heap block of size 32 at 0x7b0800000020 allocated by main thread:
    #0 malloc <null> (channel_sanitize+0x13947)
    #1 buffer_create /vagrant/buffer.c:6 (channel_sanitize+0xbcf2e)
    #2 channel_create /vagrant/channel.c:8 (channel_sanitize+0xbc979)
    #3 test_non_blocking_send /vagrant/test.c:409 (channel_sanitize+0xc0709)
    #4 single_test /vagrant/test.c:1670 (channel_sanitize+0xc4965)
    #5 main /vagrant/test.c:1709 (channel_sanitize+0x955e)

  Mutex M0 (0x7b3000000010) created at:
    #0 pthread_mutex_init <null> (channel_sanitize+0x2dbd1)
    #1 channel_create /vagrant/channel.c:10 (channel_sanitize+0xbc9a7)
    #2 test_non_blocking_send /vagrant/test.c:409 (channel_sanitize+0xc0709)
    #3 single_test /vagrant/test.c:1670 (channel_sanitize+0xc4965)
    #4 main /vagrant/test.c:1709 (channel_sanitize+0x955e)

  Thread T2 (tid=311413, running) created by main thread at:
    #0 pthread_create <null> (channel_sanitize+0x422a8)
    #1 test_non_blocking_send /vagrant/test.c:417 (channel_sanitize+0xc078b)
    #2 single_test /vagrant/test.c:1670 (channel_sanitize+0xc4965)
    #3 main /vagrant/test.c:1709 (channel_sanitize+0x955e)

  Thread T1 (tid=311412, finished) created by main thread at:
    #0 pthread_create <null> (channel_sanitize+0x422a8)
    #1 test_non_blocking_send /vagrant/test.c:417 (channel_sanitize+0xc078b)
    #2 single_test /vagrant/test.c:1670 (channel_sanitize+0xc4965)
    #3 main /vagrant/test.c:1709 (channel_sanitize+0x955e)

SUMMARY: ThreadSanitizer: data race /vagrant/channel.c:84 in channel_non_blocking_send
==================
ThreadSanitizer: reported 1 warnings
Running test case: test_non_blocking_send : Testing non_blocking send ...
ALL TESTS PASSED
Tests run: 1
